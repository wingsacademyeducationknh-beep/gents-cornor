<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENTS GARAGE | Admin</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Outfit:wght@300;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <nav>
        <div class="container">
            <a href="index.html" class="logo">GENTS <span>GARAGE</span></a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="about.html">About</a></li>
                <li id="admin-nav-item" style="display: none;"><a href="admin.html" class="active">Admin</a></li>
                <li id="profile-nav-item" style="display: none;"><a href="profile.html">My Profile</a></li>
                <li id="login-nav-item"><a href="login.html">Login / Sign Up</a></li>
                <li id="logout-nav-item" style="display: none;"><a href="#" onclick="logout()">Logout</a></li>
            </ul>
            <a href="shop.html" class="btn" style="padding: 8px 20px; font-size: 0.8rem;">Shop Now</a>
        </div>
    </nav>

    <header class="section" style="padding-bottom: 20px; background: rgba(255,255,255,0.02)">
        <div class="container">
            <h1>ADMIN <span>DASHBOARD</span></h1>
            <p style="color: var(--text-dim);">System management and user oversight.</p>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <div class="admin-grid">

                <div>
                    <h3>Shop <span>Inventory</span></h3>
                    <p style="margin-bottom: 20px; color: var(--text-dim);">Add new products to the garage catalog.</p>
                    <div class="admin-form">
                        <input type="text" id="pName" placeholder="Garment Name">
                        <input type="text" id="pPrice" placeholder="Value (e.g. $99)">
                        <input type="text" id="pImg" placeholder="Image URL (Unsplash ID or Link)">
                        <button class="btn" onclick="addProduct()">Add to Inventory</button>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>User <span>Roster</span></h3>
                    <p style="margin-bottom: 10px; color: var(--text-dim);">Manage all registered members.</p>
                    <div class="user-list-container">
                        <table class="user-list">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Mobile</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUserList">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditUserModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">Edit <span>Member</span></h2>
            <div class="login-form">
                <input type="hidden" id="editOriginalMobile">
                <label>Username</label>
                <input type="text" id="editUsername" placeholder="Username">
                <label>Mobile Number</label>
                <input type="text" id="editMobile" placeholder="Mobile">
                <label>Access Level</label>
                <select id="editRole">
                    <option value="user">Regular User</option>
                    <option value="admin">Administrator</option>
                </select>
                <label>New Password (Optional)</label>
                <input type="password" id="editPass" placeholder="Leave empty to keep current">
                <button class="btn" onclick="saveEditedUser()">Update Member</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="logo">GENTS <span>GARAGE</span></div>
            <p>&copy; 2026 Gents Garage Menswear. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Security Gate
        if (sessionStorage.getItem('userRole') !== 'admin') {
            window.location.href = 'index.html';
        }

        function initAdmin() {
            renderUsers();
        }

        function renderUsers() {
            const list = document.getElementById('adminUserList');
            if (list) {
                list.innerHTML = users.map(u => `
                    <tr>
                        <td>${u.username || 'N/A'}</td>
                        <td>${u.mobile}</td>
                        <td>${u.role === 'admin' ? '<span style="color: var(--primary); font-weight: bold;">Admin</span>' : 'User'}</td>
                        <td>Active</td>
                        <td>
                            <button class="btn" style="padding: 5px 10px; font-size: 0.7rem;" onclick="openEditUserModal('${u.mobile}')">Edit</button>
                            <button class="btn" style="padding: 5px 10px; font-size: 0.7rem; background: #cc0000; border-color: #cc0000;" onclick="deleteUser('${u.mobile}')">Del</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function addProduct() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const img = document.getElementById('pImg').value || "https://images.unsplash.com/photo-1516257984877-a03a01ae1b89?auto=format&fit=crop&q=80&w=500";
            if (name && price) {
                // In a real app, this would hit an API. Here it just alerts.
                alert(`Added ${name} to internal catalog buffer!`);
            }
        }

        function openEditUserModal(mobile) {
            const user = users.find(u => u.mobile === mobile);
            if (!user) return;
            document.getElementById('editOriginalMobile').value = user.mobile;
            document.getElementById('editUsername').value = user.username || '';
            document.getElementById('editMobile').value = user.mobile;
            document.getElementById('editRole').value = user.role || 'user';
            document.getElementById('editPass').value = '';
            document.getElementById('editUserModal').style.display = 'block';
        }

        function closeEditUserModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }

        function saveEditedUser() {
            const originalMobile = document.getElementById('editOriginalMobile').value;
            const newUsername = document.getElementById('editUsername').value.trim();
            const newMobile = document.getElementById('editMobile').value.trim();
            const newRole = document.getElementById('editRole').value;
            const newPass = document.getElementById('editPass').value;

            const userIndex = users.findIndex(u => u.mobile === originalMobile);
            if (userIndex === -1) return;

            const usernameRegex = /^[a-z0-9_]{4,16}$/;
            if (!usernameRegex.test(newUsername)) { alert('Check username format!'); return; }

            users[userIndex].username = newUsername;
            users[userIndex].mobile = newMobile;
            users[userIndex].role = newRole;
            if (newPass) users[userIndex].password = newPass;

            localStorage.setItem('gents_users', JSON.stringify(users));
            alert('Member details updated!');
            renderUsers();
            closeEditUserModal();
        }

        function deleteUser(mobile) {
            if (!confirm(`Delete user ${mobile}?`)) return;
            users = users.filter(u => u.mobile !== mobile);
            localStorage.setItem('gents_users', JSON.stringify(users));
            alert('Member removed.');
            renderUsers();
        }
    </script>
</body>

</html>